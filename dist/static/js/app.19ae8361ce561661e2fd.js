webpackJsonp([1],{NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("7+uW"),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var a=i("VU/8")({name:"App"},s,!1,function(t){i("c0J4")},null,null).exports,r=i("/ocq"),o=i("c/Tr"),h=i.n(o),l=i("//Fk"),c=i.n(l),d={data:function(){return{dataList:[],dataShowList:[],pageSize:0,totalItemNum:0,rowInScreenNum:0,wrapHeight:0,screenItemHeight:0,lastScrollTop:0,fromIndex:0,toIndex:0,lastPaddingObj:null}},props:{fnFetch:{type:Function,required:!0},itemHeight:{type:Number,default:50},loading:{type:Boolean,required:!0,default:!1}},computed:{containerPadding:function(){var t=this.fromIndex*this.itemHeight;return this.loading&&this.lastPaddingObj?this.lastPaddingObj.paddingBottom=0:this.lastPaddingObj={paddingTop:t+"px",paddingBottom:this.wrapHeight-t-this.itemHeight*this.pageSize+"px"},this.lastPaddingObj}},created:function(){this.getData()},mounted:function(){var t=this.$refs.container.offsetHeight;if(this.rowInScreenNum=Math.ceil(t/this.itemHeight),this.screenItemHeight=this.rowInScreenNum*this.itemHeight,this.pageSize=this.toIndex=2*this.rowInScreenNum,this.pageSize<this.toIndex)throw"当前滚动容器内一屏渲染"+this.rowInScreenNum+"条，pageSize必须至少为它的2倍14条"},methods:{changeLoading:function(t){this.$emit("update:loading",t)},getData:function(){var t=this;this.fetch().then(function(e){t.changeLoading(!0),t.dataList=t.dataList.concat(e),t.totalItemNum=t.dataList.length,t.setSliceData(),t.wrapHeight=t.totalItemNum*t.itemHeight})},fetch:function(){return this.fnFetch(this.dataList).then(function(t){if(!Array.isArray(t))throw"fn-fetch方法resolve的data必须为数组";return t})},setSliceData:function(){this.dataShowList=this.dataList.slice(this.fromIndex,this.toIndex)},handleMove:function(t){var e=t.target.scrollTop;if(!this.loading)if(Math.abs(e-this.lastScrollTop)>this.screenItemHeight){this.lastScrollTop=e;var i=Math.floor(this.lastScrollTop/this.screenItemHeight);i>0&&(this.fromIndex=i*this.rowInScreenNum,this.toIndex=this.fromIndex+this.pageSize,this.toIndex>=this.dataList.length?(console.log("get data, this.fromIndex",this.fromIndex,"this.toIndex",this.toIndex),this.getData()):this.setSliceData())}else{var n=Math.floor(this.lastScrollTop/e);n>0&&(console.log("up count",n),this.lastScrollTop-=this.screenItemHeight,this.lastScrollTop<this.screenItemHeight&&(this.lastScrollTop=0),this.fromIndex-=n*this.rowInScreenNum,this.fromIndex<0&&(this.fromIndex=0),this.toIndex=this.fromIndex+this.pageSize,this.setSliceData())}}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"scroll-container",on:{scroll:t.handleMove}},[i("div",{staticClass:"scroll-container__wrap",style:t.containerPadding},[t._l(t.dataShowList,function(e){return i("div",{key:e.id,staticClass:"scroll-container__item",style:{height:t.itemHeight+"px"}},[t._t("default",null,{row:e})],2)}),t._v(" "),t.loading?i("p",{staticClass:"loading"},[t._v("loading...")]):t._e()],2)])},staticRenderFns:[]};var u={components:{InfiniteScrolling:i("VU/8")(d,p,!1,function(t){i("lV+5")},null,null).exports},data:function(){return{loading:!1}},methods:{fetch:function(t){var e=this;return this.loading=!0,new c.a(function(i,n){setTimeout(function(){var n=[];h()(new Array(20)).fill(1).forEach(function(e,i){n.push({name:"item "+(i+1+t.length),id:i+1+t.length})}),e.loading=!1,i(n)},1e3)})}}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"demo"},[t._m(0),t._v(" "),i("div",{staticClass:"vue-list"},[i("div",{staticClass:"vue-list__wrap"},[i("infinite-scrolling",{attrs:{"fn-fetch":t.fetch,"item-height":70,loading:t.loading},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return i("span",{},[t._v("\n        "+t._s(n.name)+"\n      ")])}}])})],1),t._v(" "),t.$children[0]?i("div",{staticClass:"other-info"},[i("p",{staticStyle:{"font-size":"30px"}},[t._v("data present")]),t._v(" "),i("p",[t._v("is getting data: "+t._s(t.loading))]),t._v(" "),i("p",[t._v("dataList: Array["+t._s(t.$children[0].dataList.length)+"]")]),t._v(" "),i("p",[t._v("dataShowList: Array["+t._s(t.$children[0].dataShowList.length)+"]")]),t._v(" "),i("p",[t._v("fromIndex: "+t._s(t.$children[0].fromIndex))]),t._v(" "),i("p",[t._v("toIndex: "+t._s(t.$children[0].toIndex))]),t._v(" "),i("p",[t._v("pageSize: "+t._s(t.$children[0].pageSize))]),t._v(" "),i("p",[t._v("wrapHeight: "+t._s(t.$children[0].wrapHeight)+"px")]),t._v(" "),i("p",[t._v("screenItemHeight: "+t._s(t.$children[0].screenItemHeight)+"px")]),t._v(" "),i("p",[t._v("totalItemNum: "+t._s(t.$children[0].totalItemNum))]),t._v(" "),i("p",[t._v("rowInScreenNum: "+t._s(t.$children[0].rowInScreenNum))])]):t._e()]),t._v(" "),t._m(1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"text-align":"center"}},[e("p",{staticStyle:{"font-size":"30px","padding-top":"50px"}},[this._v("Vue列表无限滚动的优化方案")]),this._v(" "),e("p",{staticStyle:{color:"#999",margin:"-30px 0 50px 0"}},[this._v("\n      本文思路原理借鉴 "),e("a",{attrs:{href:"https://juejin.im/entry/5819993fbf22ec0068aab054"}},[this._v("Vue.js 一个超长列表无限滚动加载的解决方案")]),e("br"),this._v("\n      本例子为更简单实现，用2个区域实现，其是三个区域个人觉得不便于理解\n    ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticStyle:{"padding-top":"30px"}},[this._v("\n    git地址："),e("a",{attrs:{href:""}},[this._v("infinite-scrolling")]),this._v(" |\n    文章详解："),e("a",{attrs:{href:""}},[this._v("列表无限滚动的优化方案")])])}]};var g=i("VU/8")(u,f,!1,function(t){i("zkcD")},null,null).exports;n.a.use(r.a);var m=new r.a({routes:[{path:"/",name:"HelloWorld",component:g}]});n.a.config.productionTip=!1,new n.a({el:"#app",router:m,components:{App:a},template:"<App/>"})},c0J4:function(t,e){},"lV+5":function(t,e){},zkcD:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.19ae8361ce561661e2fd.js.map